---
slug: doc-uidq0n
---
# Phase 4.3 - 编辑器组件库扩展规划

> 版本: 1.1.0  
> 创建日期: 2026-01-05  
> 完成日期: 2026-01-16  
> 状态: ✅ 已完成

## 概述

### 组件库定位

ATLAS 编辑器组件库是文档数据块（`atlas-data`）的渲染和编辑核心。每个组件负责：

1. **数据展示** - 在阅读模式下展示字段值
2. **数据编辑** - 在编辑模式下提供交互控件
3. **数据验证** - 校验输入合法性
4. **组件配置** - 提供可视化配置界面

### 组件类型分类

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           组件类型分类                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  📝 输入型组件 (Input Components)                                    │   │
│   │  ─────────────────────────────────────────────────────────────────  │   │
│   │  用户手动输入或选择数据                                               │   │
│   │  示例: text, select, date, phone, email...                          │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  🧠 智能型组件 (Smart Components)                                    │   │
│   │  ─────────────────────────────────────────────────────────────────  │   │
│   │  自动获取或处理数据，需要后端服务支持                                   │   │
│   │  示例: password, login-stats, audit-log, relation-picker...         │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  👁️ 展示型组件 (Display Components)                                  │   │
│   │  ─────────────────────────────────────────────────────────────────  │   │
│   │  只读展示，将数据转换为可视化形式                                       │   │
│   │  示例: qrcode, barcode, progress, file-list...                      │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  🔗 关联型组件 (Relation Components)                                 │   │
│   │  ─────────────────────────────────────────────────────────────────  │   │
│   │  与其他文档或系统数据建立关联                                          │   │
│   │  示例: document-link, user-picker, relation-picker...               │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 一、组件库现状

### 1.1 已实现组件清单（40个）

#### 基础输入组件

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `text` | 单行文本 | 输入 | 基础文本输入 | placeholder, maxLength |
| `textarea` | 多行文本 | 输入 | 多行文本输入 | placeholder, rows, maxLength |
| `number` | 数字 | 输入 | 数字输入 | min, max, step, precision |

#### 选择类组件

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `select` | 下拉选择 | 输入 | 单选下拉菜单 | options, placeholder |
| `multi-select` | 多选下拉 | 输入 | 多选下拉菜单 | options, placeholder, maxItems |
| `radio` | 单选按钮 | 输入 | 单选按钮组 | options, direction |
| `checkbox` | 复选框 | 输入 | 复选框组 | options, direction |

#### 日期时间组件

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `date` | 日期选择 | 输入 | 日期选择器 | format, includeTime, minDate, maxDate |

#### 评分与开关

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `rating` | 评分 | 输入 | 星级评分 | max, allowHalf |
| `toggle` | 开关 | 输入 | 布尔切换 | onLabel, offLabel |

#### 联系信息组件

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `phone` | 手机号 | 输入 | 手机号输入（带格式化） | placeholder, format |
| `email` | 邮箱 | 输入 | 邮箱输入（带验证） | placeholder |
| `id-card` | 身份证 | 输入 | 身份证号输入（带掩码） | showMask |

#### 文件类组件

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `file` | 单文件 | 输入 | 单文件上传 | accept, maxSize |
| `files` | 多文件 | 输入 | 多文件上传 | accept, maxSize, maxCount |
| `image` | 单图片 | 输入 | 单图片上传 | accept, maxSize, aspectRatio |
| `images` | 多图片 | 输入 | 多图片上传 | accept, maxSize, maxCount |
| `avatar` | 头像 | 输入 | 头像上传（带裁剪） | aspectRatio, maxSize, directory |
| `file-list` | 文件列表 | 展示 | 只读文件列表 | allowDownload, allowDelete |

#### 特殊组件

| 组件ID | 名称 | 类型 | 说明 | 配置项 |
|--------|------|------|------|--------|
| `tags` | 标签 | 输入 | 标签输入 | allowCreate, options, placeholder |
| `folder-picker` | 目录选择 | 输入 | 文件系统目录选择 | multiple, placeholder |
| `id-generator` | ID生成器 | 输入 | 自动生成唯一标识 | prefix, length, format, autoGenerate, editable |

### 1.2 组件架构

```
frontend/src/components/visual-editor/ComponentRegistry/
├── components/                    # 组件目录
│   ├── text/                      # 每个组件一个目录
│   │   ├── config.ts              # 组件配置定义
│   │   ├── Control.tsx            # 编辑控件
│   │   ├── Configurator.tsx       # 配置面板
│   │   └── index.ts               # 导出
│   ├── select/
│   ├── date/
│   ├── ... (40个组件)
│   └── avatar/
├── shared/                        # 共享组件
│   ├── FallbackControl.tsx        # 回退控件
│   ├── FolderPicker.tsx           # 目录选择器
│   ├── OptionEditor.tsx           # 选项编辑器
│   └── utils.ts                   # 工具函数
├── registry.ts                    # 组件注册表
├── types.ts                       # 类型定义
├── ComponentControl.tsx           # 控件渲染器
├── ComponentConfigurator.tsx      # 配置器渲染器
└── index.ts                       # 导出
```

### 1.3 组件接口规范

```typescript
// 组件配置定义
interface ComponentConfig {
  type: string;                    // 组件类型 ID
  label: string;                   // 显示名称
  icon: LucideIcon;                // 图标
  category: ComponentCategory;      // 分类
  defaultConfig: Record<string, any>;  // 默认配置
  configSchema: ConfigField[];     // 配置项定义
}

// 控件 Props
interface ControlProps {
  value: any;                      // 当前值
  onChange: (value: any) => void;  // 值变更回调
  config: Record<string, any>;     // 组件配置
  disabled?: boolean;              // 是否禁用
  fieldKey: string;                // 字段键名
}

// 配置器 Props
interface ConfiguratorProps {
  config: Record<string, any>;     // 当前配置
  onChange: (config: Record<string, any>) => void;  // 配置变更回调
}
```

---

## 二、扩展规划（已完成）

### 2.1 第一优先级：安全与认证组件 ✅

> 工期: 1 周 - 已完成

#### password - 安全密码组件

```yaml
组件ID: password
名称: 安全密码
类型: 智能
依赖: bcrypt (后端)

功能:
  - 密码输入（带显示/隐藏切换）
  - 密码强度实时检测
  - 自动生成强密码
  - 存储时自动 bcrypt 加密
  - 前端永不显示明文，只显示 "已设置" 状态
  - 支持重置密码

配置项:
  - minLength: 最小长度 (默认 8)
  - requireUppercase: 要求大写 (默认 true)
  - requireLowercase: 要求小写 (默认 true)
  - requireNumber: 要求数字 (默认 true)
  - requireSpecial: 要求特殊字符 (默认 false)
  - showStrengthMeter: 显示强度指示器 (默认 true)
  - allowGenerate: 允许自动生成 (默认 true)
  - generatedLength: 生成密码长度 (默认 16)

UI设计:
  编辑模式:
  ┌─────────────────────────────────────────────────────┐
  │ 🔐 登录密码                                          │
  ├─────────────────────────────────────────────────────┤
  │ 状态: ✅ 已设置                                       │
  │                                                      │
  │ [🔄 重置密码]  [🎲 生成强密码]                        │
  └─────────────────────────────────────────────────────┘
  
  重置密码弹窗:
  ┌─────────────────────────────────────────────────────┐
  │ 设置新密码:                                          │
  │ ┌───────────────────────────────────────┐           │
  │ │ ••••••••••••                          │ 👁        │
  │ └───────────────────────────────────────┘           │
  │ 强度: ████████░░ 强                                  │
  │                                                      │
  │ 确认新密码:                                          │
  │ ┌───────────────────────────────────────┐           │
  │ │ ••••••••••••                          │ 👁        │
  │ └───────────────────────────────────────┘           │
  │ ✅ 密码匹配                                          │
  │                              [取消] [确认修改]        │
  └─────────────────────────────────────────────────────┘

后端API:
  POST /api/password/hash
  POST /api/password/verify
  POST /api/password/generate
```

#### timestamp - 时间戳组件

```yaml
组件ID: timestamp
名称: 时间戳
类型: 智能
依赖: 无

功能:
  - 自动记录创建时间
  - 自动更新修改时间
  - 支持多种显示格式
  - 只读展示

配置项:
  - type: 类型 (created | updated | custom)
  - format: 显示格式 (默认 YYYY-MM-DD HH:mm:ss)
  - showRelative: 显示相对时间 (默认 false)
  - autoUpdate: 自动更新 (默认 true, 仅 updated 类型)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📅 创建时间: 2026-01-05 14:32:15                     │
  │ 📅 更新时间: 2分钟前 (2026-01-05 16:45:22)           │
  └─────────────────────────────────────────────────────┘
```

### 2.2 第二优先级：展示增强组件 ✅

> 工期: 1 周 - 已完成

#### url - URL输入组件

```yaml
组件ID: url
名称: URL链接
类型: 输入
依赖: 无

功能:
  - URL 输入框
  - 自动补全 http:// 前缀
  - URL 格式验证
  - 可选预览功能
  - 点击跳转

配置项:
  - placeholder: 占位符
  - showPreview: 显示预览 (默认 false)
  - openInNewTab: 新标签页打开 (默认 true)
  - allowedProtocols: 允许的协议 (默认 ['http', 'https'])

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 🔗 官网: [https://example.com_____________] [↗]     │
  └─────────────────────────────────────────────────────┘
```

#### color - 颜色选择组件

```yaml
组件ID: color
名称: 颜色选择
类型: 输入
依赖: 无

功能:
  - 颜色选择器
  - 支持 HEX、RGB、HSL 格式
  - 预设颜色快捷选择
  - 透明度支持（可选）

配置项:
  - format: 输出格式 (hex | rgb | hsl)
  - presets: 预设颜色列表
  - allowAlpha: 允许透明度 (默认 false)
  - showInput: 显示输入框 (默认 true)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 🎨 主题色: [■] #3B82F6  [🎨]                         │
  │                                                      │
  │ 预设: [■][■][■][■][■][■][■][■]                       │
  └─────────────────────────────────────────────────────┘
```

#### icon-picker - 图标选择组件

```yaml
组件ID: icon-picker
名称: 图标选择
类型: 输入
依赖: lucide-react

功能:
  - 从 Lucide 图标库选择
  - 搜索过滤
  - 分类浏览
  - 预览显示

配置项:
  - categories: 显示的图标分类
  - searchable: 启用搜索 (默认 true)
  - showLabel: 显示图标名称 (默认 false)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 🔍 图标: [⚙️ settings] [选择]                        │
  │                                                      │
  │ 搜索: [____________]                                 │
  │ ┌────────────────────────────────────────────────┐  │
  │ │ ⚙️ 🏠 📁 📄 👤 ⭐ 🔔 📧 📱 💼 🎯 🔒 🔑 ⚡ │  │
  │ │ 📊 📈 📉 💡 🎨 🔧 ⏰ 📅 🗂️ 🏷️ 🔗 📌 ✅ ❌ │  │
  │ └────────────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────────┘
```

#### progress - 进度条组件

```yaml
组件ID: progress
名称: 进度条
类型: 展示/输入
依赖: 无

功能:
  - 进度条展示
  - 可选可编辑（滑块）
  - 百分比显示
  - 自定义颜色

配置项:
  - editable: 是否可编辑 (默认 false)
  - showLabel: 显示百分比 (默认 true)
  - color: 进度条颜色
  - trackColor: 轨道颜色
  - height: 高度 (默认 8px)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📊 完成进度: ████████████░░░░░░░░ 65%               │
  └─────────────────────────────────────────────────────┘
```

#### qrcode - 二维码组件

```yaml
组件ID: qrcode
名称: 二维码
类型: 展示
依赖: qrcode 库

功能:
  - 将字段值生成二维码
  - 支持自定义大小
  - 支持下载
  - 支持设置容错级别

配置项:
  - size: 尺寸 (默认 128)
  - errorCorrectionLevel: 容错级别 (L | M | Q | H)
  - fgColor: 前景色 (默认 #000000)
  - bgColor: 背景色 (默认 #FFFFFF)
  - allowDownload: 允许下载 (默认 true)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📱 二维码:                                           │
  │ ┌──────────┐                                        │
  │ │ ▓▓▓▓▓▓▓▓ │                                        │
  │ │ ▓      ▓ │                                        │
  │ │ ▓ ▓▓▓▓ ▓ │                                        │
  │ │ ▓      ▓ │                                        │
  │ │ ▓▓▓▓▓▓▓▓ │  [📥 下载]                             │
  │ └──────────┘                                        │
  └─────────────────────────────────────────────────────┘
```

#### barcode - 条形码组件

```yaml
组件ID: barcode
名称: 条形码
类型: 展示
依赖: jsbarcode 库

功能:
  - 将字段值生成条形码
  - 支持多种格式
  - 支持下载

配置项:
  - format: 格式 (CODE128 | EAN13 | UPC | CODE39...)
  - width: 线条宽度 (默认 2)
  - height: 高度 (默认 100)
  - displayValue: 显示文字 (默认 true)
  - allowDownload: 允许下载 (默认 true)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📊 条形码:                                           │
  │ ┌────────────────────────────────┐                  │
  │ │ ║│║║│║║║│║│║║║│║│║║║│║║│║║║│║│║║ │                  │
  │ │        1234567890123            │  [📥 下载]      │
  │ └────────────────────────────────┘                  │
  └─────────────────────────────────────────────────────┘
```

### 2.3 第三优先级：关联与引用组件 ✅

> 工期: 1.5 周 - 已完成
> 依赖: Phase 4.2 索引服务

#### document-link - 文档链接组件

```yaml
组件ID: document-link
名称: 文档链接
类型: 关联
依赖: 无

功能:
  - 链接到仓库中的其他文档
  - 支持搜索选择
  - 显示链接文档标题
  - 点击跳转

配置项:
  - placeholder: 占位符
  - allowMultiple: 允许多选 (默认 false)
  - filter: 文档类型过滤 (可选)
  - showPath: 显示文档路径 (默认 false)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📄 关联文档: [客户管理/张三.md] [×]  [+ 选择]        │
  └─────────────────────────────────────────────────────┘
```

#### relation-picker - 关联选择组件

```yaml
组件ID: relation-picker
名称: 关联选择
类型: 智能/关联
依赖: 索引服务

功能:
  - 从指定索引中选择关联记录
  - 支持搜索过滤
  - 显示关联记录摘要
  - 支持单选/多选

配置项:
  - index: 关联索引 (如 clients, projects)
  - displayField: 显示字段 (默认 name)
  - searchFields: 搜索字段
  - multiple: 允许多选 (默认 false)
  - filter: 过滤条件 (可选)
  - showDetails: 显示详情 (默认 false)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 👔 关联客户: [张三 - ABC科技有限公司] [×]  [选择]    │
  │                                                      │
  │ 搜索选择:                                            │
  │ ┌────────────────────────────────────────────────┐  │
  │ │ 🔍 [搜索客户名称...]                            │  │
  │ │                                                 │  │
  │ │ □ 张三   ABC科技有限公司   VIP                  │  │
  │ │ □ 李四   XYZ贸易公司       普通                 │  │
  │ │ □ 王五   DEF制造公司       重点                 │  │
  │ └────────────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────────┘
```

#### user-picker - 用户选择组件

```yaml
组件ID: user-picker
名称: 用户选择
类型: 智能/关联
依赖: 索引服务（用户索引）

功能:
  - 从用户索引中选择用户
  - 显示用户头像和名称
  - 支持角色过滤
  - 支持单选/多选

配置项:
  - multiple: 允许多选 (默认 false)
  - showAvatar: 显示头像 (默认 true)
  - roleFilter: 角色过滤 (可选)
  - statusFilter: 状态过滤 (默认 verified)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 👤 负责人: [○ 张三]  [选择]                          │
  │                                                      │
  │ 🔍 [搜索用户...]                                     │
  │ ┌────────────────────────────────────────────────┐  │
  │ │ ○ 张三   管理员                                 │  │
  │ │ ○ 李四   销售                                   │  │
  │ │ ○ 王五   运营                                   │  │
  │ └────────────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────────┘
```

### 2.4 第四优先级：高级计算组件 ✅

> 工期: 1 周 - 已完成

#### computed - 计算字段组件

```yaml
组件ID: computed
名称: 计算字段
类型: 智能
依赖: 无

功能:
  - 根据其他字段自动计算值
  - 支持基础运算
  - 支持字符串拼接
  - 只读展示

配置项:
  - expression: 计算表达式
  - dependencies: 依赖字段列表
  - format: 结果格式化
  - decimals: 小数位数 (数字时)

表达式示例:
  - "{price} * {quantity}"           # 数学计算
  - "{firstName} {lastName}"         # 字符串拼接
  - "{total} * 0.1"                  # 百分比计算

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 💰 总金额: ¥12,500.00  (= 单价 × 数量)              │
  │ 📊 税额: ¥1,250.00  (= 总金额 × 10%)               │
  └─────────────────────────────────────────────────────┘
```

#### formula - 公式字段组件

```yaml
组件ID: formula
名称: 公式字段
类型: 智能
依赖: mathjs 库

功能:
  - 支持复杂数学公式
  - 支持内置函数
  - 实时计算
  - 错误处理

配置项:
  - formula: 公式字符串
  - variables: 变量映射
  - format: 结果格式
  - errorValue: 错误时的默认值

公式示例:
  - "sum(items.price)"
  - "round(total * taxRate, 2)"
  - "if(quantity > 100, price * 0.9, price)"

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📐 计算结果: 1,234.56                               │
  │ 公式: round(price * quantity * (1 - discount), 2)  │
  └─────────────────────────────────────────────────────┘
```

### 2.5 第五优先级：特殊输入组件 ✅

> 工期: 1.5 周 - 已完成

#### signature - 手写签名组件

```yaml
组件ID: signature
名称: 手写签名
类型: 输入
依赖: canvas

功能:
  - 手写签名板
  - 支持触屏和鼠标
  - 清除重签
  - 保存为图片

配置项:
  - width: 宽度 (默认 400)
  - height: 高度 (默认 200)
  - strokeColor: 笔触颜色 (默认 #000)
  - strokeWidth: 笔触粗细 (默认 2)
  - backgroundColor: 背景色 (默认 #fff)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ ✍️ 签名:                                             │
  │ ┌────────────────────────────────────────────────┐  │
  │ │                                                 │  │
  │ │           ~ 签名区域 ~                          │  │
  │ │                                                 │  │
  │ └────────────────────────────────────────────────┘  │
  │ [🗑️ 清除] [💾 确认]                                  │
  └─────────────────────────────────────────────────────┘
```

#### rich-text - 富文本组件

```yaml
组件ID: rich-text
名称: 富文本
类型: 输入
依赖: tiptap

功能:
  - 富文本编辑
  - 支持粗体、斜体、下划线
  - 支持列表
  - 支持链接
  - 支持图片插入

配置项:
  - toolbar: 工具栏配置
  - placeholder: 占位符
  - minHeight: 最小高度
  - maxHeight: 最大高度

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ [B][I][U][📎][🔗][•][1.]                            │
  │ ┌────────────────────────────────────────────────┐  │
  │ │ 这是一段 **富文本** 内容...                     │  │
  │ │                                                 │  │
  │ └────────────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────────┘
```

#### json - JSON编辑组件

```yaml
组件ID: json
名称: JSON编辑
类型: 输入
依赖: 无

功能:
  - JSON 编辑器
  - 语法高亮
  - 格式化
  - 校验

配置项:
  - schema: JSON Schema (可选)
  - minHeight: 最小高度
  - maxHeight: 最大高度
  - readOnly: 只读模式

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📋 配置数据:                    [格式化] [校验]     │
  │ ┌────────────────────────────────────────────────┐  │
  │ │ {                                              │  │
  │ │   "key": "value",                              │  │
  │ │   "nested": {                                  │  │
  │ │     "item": 123                                │  │
  │ │   }                                            │  │
  │ │ }                                              │  │
  │ └────────────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────────┘
```

### 2.6 第六优先级：审计与日志组件 ✅

> 工期: 1 周 - 已完成
> 依赖: Phase 4.2 索引服务 + 审计服务

#### login-stats - 登录统计组件

```yaml
组件ID: login-stats
名称: 登录统计
类型: 智能
依赖: 索引服务（用户日志）

功能:
  - 显示用户登录统计
  - 最后登录时间
  - 登录次数
  - 登录设备/IP（可选）
  - 只读展示

配置项:
  - userIdField: 关联用户ID字段
  - showLastLogin: 显示最后登录 (默认 true)
  - showLoginCount: 显示登录次数 (默认 true)
  - showDevice: 显示设备信息 (默认 false)
  - showIp: 显示IP地址 (默认 false)
  - showHistory: 显示历史记录 (默认 false)
  - historyLimit: 历史记录数量 (默认 5)

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📊 登录统计                                          │
  ├─────────────────────────────────────────────────────┤
  │ 最后登录: 2026-01-05 14:32:15                       │
  │ 登录次数: 156 次                                     │
  │ 登录设备: Chrome / macOS                            │
  │ 登录 IP:  192.168.1.100                             │
  └─────────────────────────────────────────────────────┘
```

#### audit-log - 审计日志组件

```yaml
组件ID: audit-log
名称: 审计日志
类型: 智能
依赖: 审计服务

功能:
  - 显示文档变更历史
  - 显示修改人、时间、内容
  - 支持展开/折叠
  - 支持字段级别差异
  - 只读展示

配置项:
  - limit: 显示数量 (默认 10)
  - showUser: 显示操作用户 (默认 true)
  - showDiff: 显示差异 (默认 false)
  - trackFields: 追踪字段列表 (空=全部)
  - excludeFields: 排除字段列表

UI设计:
  ┌─────────────────────────────────────────────────────┐
  │ 📋 变更记录                                          │
  ├─────────────────────────────────────────────────────┤
  │ 🕐 2026-01-05 14:32  张三                           │
  │    修改了: 客户等级 普通 → VIP                       │
  │                                                      │
  │ 🕐 2026-01-04 10:15  李四                           │
  │    修改了: 联系电话 138****0000 → 139****1111        │
  │                                                      │
  │ 🕐 2026-01-03 09:00  系统                           │
  │    创建文档                                          │
  │                                                      │
  │ [查看更多...]                                        │
  └─────────────────────────────────────────────────────┘
```

---

## 三、开发规范

### 3.1 组件目录结构

```
components/{component-id}/
├── config.ts           # 组件配置定义
├── Control.tsx         # 编辑/展示控件
├── Configurator.tsx    # 配置面板
├── index.ts            # 导出
├── utils.ts            # 工具函数（可选）
└── types.ts            # 类型定义（可选）
```

### 3.2 config.ts 模板

```typescript
import { ComponentConfig } from '../../types';
import { IconName } from 'lucide-react';

export const config: ComponentConfig = {
  type: 'component-id',
  label: '组件名称',
  icon: IconName,
  category: 'input' | 'smart' | 'display' | 'relation',
  description: '组件描述',
  defaultConfig: {
    // 默认配置
  },
  configSchema: [
    {
      key: 'configKey',
      label: '配置项名称',
      type: 'text' | 'number' | 'boolean' | 'select' | 'options',
      defaultValue: '',
      description: '配置项说明',
    },
  ],
};
```

### 3.3 Control.tsx 模板

```typescript
import React from 'react';
import { ControlProps } from '../../types';

export const Control: React.FC<ControlProps> = ({
  value,
  onChange,
  config,
  disabled,
  fieldKey,
}) => {
  return (
    <div className="component-control">
      {/* 控件实现 */}
    </div>
  );
};
```

### 3.4 Configurator.tsx 模板

```typescript
import React from 'react';
import { ConfiguratorProps } from '../../types';

export const Configurator: React.FC<ConfiguratorProps> = ({
  config,
  onChange,
}) => {
  return (
    <div className="component-configurator space-y-4">
      {/* 配置项实现 */}
    </div>
  );
};
```

### 3.5 注册组件

```typescript
// registry.ts
import * as componentId from './components/component-id';

export const componentRegistry = {
  // ... 已有组件
  'component-id': componentId,
};
```

---

## 四、开发计划（已完成）

### 4.1 任务清单

| 阶段 | 组件 | 类型 | 优先级 | 工期 | 依赖项 | 状态 |
|------|------|------|--------|------|--------|------|
| **4.3.1** | password | 智能 | 🔴 高 | 3天 | bcrypt | ✅ 集成于 user-auth |
| **4.3.1** | timestamp | 智能 | 🔴 高 | 1天 | 无 | ✅ 已完成 |
| **4.3.2** | url | 输入 | 🟡 中 | 1天 | 无 | ✅ 已完成 |
| **4.3.2** | color | 输入 | 🟡 中 | 1天 | 无 | ✅ 已完成 |
| **4.3.2** | icon-picker | 输入 | 🟡 中 | 1天 | lucide | ✅ 已完成 |
| **4.3.2** | progress | 展示 | 🟡 中 | 1天 | 无 | ✅ 已完成 |
| **4.3.2** | qrcode | 展示 | 🟡 中 | 1天 | qrcode | ✅ 已完成 |
| **4.3.2** | barcode | 展示 | 🟡 中 | 1天 | jsbarcode | ✅ 已完成 |
| **4.3.3** | document-link | 关联 | 🟡 中 | 2天 | 无 | ✅ 已完成 |
| **4.3.3** | relation-picker | 智能 | 🟡 中 | 3天 | 索引服务 | ✅ 已完成 |
| **4.3.3** | user-picker | 智能 | 🟡 中 | 2天 | 索引服务 | ✅ 已完成 |
| **4.3.4** | computed | 智能 | 🟢 低 | 2天 | 无 | ✅ 已完成 |
| **4.3.4** | formula | 智能 | 🟢 低 | 2天 | mathjs | ✅ 已完成 |
| **4.3.5** | signature | 输入 | 🟢 低 | 2天 | canvas | ✅ 已完成 |
| **4.3.5** | rich-text | 输入 | 🟢 低 | 3天 | tiptap | ✅ 已完成 |
| **4.3.5** | json | 输入 | 🟢 低 | 2天 | 无 | ✅ 已完成 |
| **4.3.6** | login-stats | 智能 | 🟢 低 | 2天 | 索引服务 | ✅ 已完成 |
| **4.3.6** | audit-log | 智能 | 🟢 低 | 3天 | 审计服务 | ✅ 已完成 |

### 4.2 里程碑（全部完成）

```
Phase 4.3.1 (第1周):  password + timestamp                                    ✅ 已完成
Phase 4.3.2 (第2周):  url + color + icon-picker + progress + qrcode + barcode ✅ 已完成
Phase 4.3.3 (第3周):  document-link + relation-picker + user-picker           ✅ 已完成
Phase 4.3.4 (第4周):  computed + formula                                      ✅ 已完成
Phase 4.3.5 (第5周):  signature + rich-text + json                            ✅ 已完成
Phase 4.3.6 (第6周):  login-stats + audit-log                                 ✅ 已完成
```

### 4.3 依赖关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           组件依赖关系图                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   无依赖组件 (可立即开发)                                                     │
│   ─────────────────────                                                     │
│   password, timestamp, url, color, icon-picker, progress                    │
│   document-link, computed, signature, json                                  │
│                                                                              │
│   需要第三方库                                                                │
│   ─────────────                                                             │
│   qrcode      → qrcode 库                                                   │
│   barcode     → jsbarcode 库                                                │
│   formula     → mathjs 库                                                   │
│   rich-text   → tiptap 库                                                   │
│                                                                              │
│   需要 Phase 4.2 索引服务                                                    │
│   ─────────────────────                                                     │
│   relation-picker  → 索引查询 API                                           │
│   user-picker      → 用户索引                                               │
│   login-stats      → 用户日志索引                                           │
│                                                                              │
│   需要审计服务                                                                │
│   ───────────                                                               │
│   audit-log  → 审计日志 API                                                 │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、组件分类汇总

### 5.1 按类型分类

| 类型 | 原有 | 新增 | 总计 | 状态 |
|------|------|------|------|------|
| 📝 输入型 | 18 | 6 | 24 | ✅ |
| 🧠 智能型 | 1 | 8 | 9 | ✅ |
| 👁️ 展示型 | 2 | 3 | 5 | ✅ |
| 🔗 关联型 | 1 | 2 | 3 | ✅ |
| 🔐 安全型 | 0 | 1 | 1 | ✅ |
| **合计** | **22** | **18** | **40** | ✅ |

### 5.2 完整组件清单

#### 输入型组件 (24)

| 组件ID | 名称 | 状态 | 来源 |
|--------|------|------|------|
| text | 单行文本 | ✅ 已实现 | 原有 |
| textarea | 多行文本 | ✅ 已实现 | 原有 |
| number | 数字 | ✅ 已实现 | 原有 |
| select | 下拉选择 | ✅ 已实现 | 原有 |
| multi-select | 多选下拉 | ✅ 已实现 | 原有 |
| radio | 单选按钮 | ✅ 已实现 | 原有 |
| checkbox | 复选框 | ✅ 已实现 | 原有 |
| date | 日期选择 | ✅ 已实现 | 原有 |
| rating | 评分 | ✅ 已实现 | 原有 |
| toggle | 开关 | ✅ 已实现 | 原有 |
| phone | 手机号 | ✅ 已实现 | 原有 |
| email | 邮箱 | ✅ 已实现 | 原有 |
| id-card | 身份证 | ✅ 已实现 | 原有 |
| file | 单文件 | ✅ 已实现 | 原有 |
| files | 多文件 | ✅ 已实现 | 原有 |
| image | 单图片 | ✅ 已实现 | 原有 |
| images | 多图片 | ✅ 已实现 | 原有 |
| avatar | 头像 | ✅ 已实现 | 原有 |
| tags | 标签 | ✅ 已实现 | 原有 |
| url | URL链接 | ✅ 已实现 | 🆕 4.3 |
| color | 颜色选择 | ✅ 已实现 | 🆕 4.3 |
| icon-picker | 图标选择 | ✅ 已实现 | 🆕 4.3 |
| signature | 手写签名 | ✅ 已实现 | 🆕 4.3 |
| rich-text | 富文本 | ✅ 已实现 | 🆕 4.3 |
| json | JSON编辑 | ✅ 已实现 | 🆕 4.3 |

#### 智能型组件 (9)

| 组件ID | 名称 | 状态 | 来源 |
|--------|------|------|------|
| id-generator | ID生成器 | ✅ 已实现 | 原有 |
| timestamp | 时间戳 | ✅ 已实现 | 🆕 4.3 |
| computed | 计算字段 | ✅ 已实现 | 🆕 4.3 |
| formula | 公式字段 | ✅ 已实现 | 🆕 4.3 |
| relation-picker | 关联选择 | ✅ 已实现 | 🆕 4.3 |
| user-picker | 用户选择 | ✅ 已实现 | 🆕 4.3 |
| login-stats | 登录统计 | ✅ 已实现 | 🆕 4.3 |
| audit-log | 审计日志 | ✅ 已实现 | 🆕 4.3 |

#### 展示型组件 (4)

| 组件ID | 名称 | 状态 | 来源 |
|--------|------|------|------|
| file-list | 文件列表 | ✅ 已实现 | 原有 |
| progress | 进度条 | ✅ 已实现 | 🆕 4.3 |
| qrcode | 二维码 | ✅ 已实现 | 🆕 4.3 |
| barcode | 条形码 | ✅ 已实现 | 🆕 4.3 |

#### 关联型组件 (3)

| 组件ID | 名称 | 状态 | 来源 |
|--------|------|------|------|
| folder-picker | 目录选择 | ✅ 已实现 | 原有 |
| document-link | 文档链接 | ✅ 已实现 | 🆕 4.3 |

#### 安全型组件 (1)

| 组件ID | 名称 | 状态 | 来源 |
|--------|------|------|------|
| user-auth | 用户认证（含 password） | ✅ 已实现 | 🆕 4.2/4.3 |

---

## 附录

### A. 相关文档

- [Phase-4.1-类型插件包与数据块资产池](./Phase-4.1-类型插件包与数据块资产池.md)
- [Phase-4.2-索引服务与身份认证系统](./Phase-4.2-索引服务与身份认证系统.md)
- [数据块组件插件化开发标准与注册机制](./数据块组件插件化开发标准与注册机制.md)

### B. 第三方库依赖

| 库名 | 用途 | 组件 |
|------|------|------|
| qrcode | 二维码生成 | qrcode |
| jsbarcode | 条形码生成 | barcode |
| mathjs | 数学计算 | formula |
| tiptap | 富文本编辑 | rich-text |
| bcrypt | 密码加密 | password |

---

*文档版本: 1.1.0*  
*创建日期: 2026-01-05*  
*完成日期: 2026-01-16*  
*作者: ATLAS Team*

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.0.0 | 2026-01-05 | 初始规划文档 |
| 1.1.0 | 2026-01-16 | 所有 18 个规划组件已完成开发，更新文档状态 |

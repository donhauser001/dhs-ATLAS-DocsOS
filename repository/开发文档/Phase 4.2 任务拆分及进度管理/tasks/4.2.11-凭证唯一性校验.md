---
slug: doc-0ri8zz
---
# 4.2.11 - å‡­è¯å”¯ä¸€æ€§æ ¡éªŒ

> ä¼˜å…ˆçº§: ğŸ”´ é«˜  
> é¢„ä¼°å·¥æœŸ: 1 å¤©  
> ä¾èµ–ä»»åŠ¡: 4.2.4  
> çŠ¶æ€: âœ… å·²å®Œæˆ

## ä»»åŠ¡æ¦‚è¿°

å®ç°å‡­è¯ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºï¼‰å”¯ä¸€æ€§æ ¡éªŒï¼Œç¡®ä¿åœ¨æ–‡æ¡£ä¿å­˜æ—¶éªŒè¯å‡­è¯ä¸ä¸å…¶ä»–ç”¨æˆ·å†²çªã€‚

## ç›®æ ‡

- [x] å®ç°å”¯ä¸€æ€§æ ¡éªŒå‡½æ•°
- [x] æ–‡æ¡£ä¿å­˜æ—¶è§¦å‘æ ¡éªŒ
- [x] å‰ç«¯å®æ—¶æ ¡éªŒåé¦ˆ
- [x] é”™è¯¯æç¤º

## æŠ€æœ¯è¦ç‚¹

### æ ¡éªŒé€»è¾‘

```typescript
async function validateCredentialUniqueness(
  docPath: string,
  authData: AuthBlockData
): Promise<{ valid: boolean; error?: string }> {
  const index = await getAuthUsersIndex();
  
  // æ£€æŸ¥ç”¨æˆ·å
  if (authData.username) {
    const existing = index.credentials[authData.username];
    if (existing && existing.user_id !== authData.user_id) {
      return { valid: false, error: `ç”¨æˆ·å "${authData.username}" å·²è¢«ä½¿ç”¨` };
    }
  }
  
  // æ£€æŸ¥é‚®ç®±...
  // æ£€æŸ¥æ‰‹æœº...
  
  return { valid: true };
}
```

### API è®¾è®¡

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/auth/validate-credential | æ ¡éªŒå‡­è¯å”¯ä¸€æ€§ |

## æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ |
|------|----------|
| `backend/src/services/auth-credential-indexer.ts` | ä¿®æ”¹ |
| `backend/src/api/auth.ts` | ä¿®æ”¹ |
| `frontend/src/components/visual-editor/ComponentRegistry/components/user-auth/Control.tsx` | ä¿®æ”¹ |

## éªŒæ”¶æ ‡å‡†

1. é‡å¤ç”¨æˆ·åè¢«æ­£ç¡®æ‹’ç»
2. é‡å¤é‚®ç®±è¢«æ­£ç¡®æ‹’ç»
3. é‡å¤æ‰‹æœºè¢«æ­£ç¡®æ‹’ç»
4. åŒä¸€ç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å‡­è¯ä¸è¢«æ‹’ç»
5. å‰ç«¯å®æ—¶åé¦ˆ

## è¿›åº¦è®°å½•

| æ—¥æœŸ | è¿›åº¦ | å¤‡æ³¨ |
|------|------|------|
| 2026-01-06 | 100% | å…¨éƒ¨å®Œæˆ |

---

*åˆ›å»ºæ—¥æœŸ: 2026-01-06*  
*å®Œæˆæ—¥æœŸ: 2026-01-06*


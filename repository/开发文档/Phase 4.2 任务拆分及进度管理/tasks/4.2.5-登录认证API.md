# 4.2.5 - ç™»å½•è®¤è¯ API

> ä¼˜å…ˆçº§: ğŸ”´ é«˜  
> é¢„ä¼°å·¥æœŸ: 2 å¤©  
> ä¾èµ–ä»»åŠ¡: 4.2.4  
> çŠ¶æ€: âœ… å·²å®Œæˆ

## ä»»åŠ¡æ¦‚è¿°

å®ç°æ–°çš„ç™»å½•è®¤è¯ APIï¼ŒåŸºäº `auth-users.json` ç´¢å¼•è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œå®Œå…¨æ›¿ä»£ç°æœ‰ Principal è®¤è¯æ–¹å¼ã€‚

## ç›®æ ‡

- [x] å®ç°ç™»å½• API
- [x] å®ç°ç™»å‡º API
- [x] å®ç°è·å–å½“å‰ç”¨æˆ· API
- [x] å®ç°ä¿®æ”¹å¯†ç  API
- [x] JWT Token ç®¡ç†

## æŠ€æœ¯è¦ç‚¹

### API è®¾è®¡

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/auth/login | ç™»å½• |
| POST | /api/auth/logout | ç™»å‡º |
| GET | /api/auth/me | è·å–å½“å‰ç”¨æˆ· |
| POST | /api/auth/change-password | ä¿®æ”¹å¯†ç  |

### ç™»å½•æµç¨‹

```
1. æŸ¥æ‰¾å‡­è¯ â†’ credentials[credential]
2. è·å–ç”¨æˆ· â†’ users[user_id]
3. æ£€æŸ¥çŠ¶æ€ â†’ status === "active"
4. éªŒè¯å¯†ç  â†’ bcrypt.compare()
5. æ£€æŸ¥è¿‡æœŸ â†’ expired_at
6. è·å–æƒé™ â†’ roles[role].permissions
7. ç”Ÿæˆ Token â†’ JWT
8. æ›´æ–°ç™»å½•æ—¶é—´
```

### çŠ¶æ€æ£€æŸ¥

```typescript
const statusMessages = {
  pending: 'è´¦æˆ·å°šæœªæ¿€æ´»ï¼Œè¯·å…ˆå®Œæˆæ¿€æ´»',
  disabled: 'è´¦æˆ·å·²è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜',
  locked: 'è´¦æˆ·å·²è¢«é”å®šï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»ç®¡ç†å‘˜',
  expired: 'è´¦æˆ·å·²è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜ç»­æœŸ',
};
```

## æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ |
|------|----------|
| `backend/src/services/auth-service.ts` | é‡å†™ |
| `backend/src/api/auth.ts` | ä¿®æ”¹ |

## å­ä»»åŠ¡

- [x] Day 1: å®ç°ç™»å½•/ç™»å‡º APIï¼ŒToken ç®¡ç†
- [x] Day 2: å®ç° me/change-password APIï¼ŒçŠ¶æ€æ£€æŸ¥

## éªŒæ”¶æ ‡å‡†

1. æ”¯æŒç”¨æˆ·å/é‚®ç®±/æ‰‹æœºç™»å½•
2. æ­£ç¡®æ£€æŸ¥è´¦æˆ·çŠ¶æ€
3. JWT Token æ­£ç¡®ç”Ÿæˆå’ŒéªŒè¯
4. å¯†ç ä¿®æ”¹åŠŸèƒ½æ­£å¸¸
5. ä¸åŒçŠ¶æ€è¿”å›å¯¹åº”é”™è¯¯ä¿¡æ¯

## è¿›åº¦è®°å½•

| æ—¥æœŸ | è¿›åº¦ | å¤‡æ³¨ |
|------|------|------|
| 2026-01-06 | 100% | å…¨éƒ¨å®Œæˆ |

---

*åˆ›å»ºæ—¥æœŸ: 2026-01-06*  
*å®Œæˆæ—¥æœŸ: 2026-01-06*


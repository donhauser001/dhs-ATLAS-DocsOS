# Person 插件包能力声明
# 定义该类型包启用的系统能力
# 
# 验收条件：卸载 person 插件包后，系统中不得再存在任何相关入口

# 核心能力声明（必须全部实现）
core_capabilities:
  # 1. 主体识别能力
  - id: "identity_recognition"
    name: "主体识别"
    description: "识别并索引系统中的人员主体"
    enabled: true
    required: true
    
  # 2. 主体索引能力
  - id: "person_index"
    name: "主体索引"
    description: "维护 person 的 staging 和 verified 双索引"
    enabled: true
    required: true
    provides:
      - "staging_index"
      - "verified_index"
      - "search_index"
    
  # 3. 审核与升级能力
  - id: "staging_review"
    name: "审核与升级"
    description: "从 staging 审核并升级到 verified"
    enabled: true
    required: true
    actions:
      - "confirm_person"      # 确认是 Person
      - "complete_fields"     # 补全缺失字段
      - "resolve_conflict"    # 处理冲突
      - "reject_person"       # 拒绝并移出
    
  # 4. 登录邀请与启用能力
  - id: "login_eligibility"
    name: "登录邀请与启用"
    description: "管理 person 的登录资格和邀请流程"
    enabled: true
    required: true
    states:
      - "none"        # 无登录资格
      - "eligible"    # 满足字段合同
      - "invited"     # 已发送邀请
      - "active"      # 可登录
      - "suspended"   # 禁用
    actions:
      - "send_invite"         # 发送邀请
      - "claim_account"       # 认领账户
      - "enable_login"        # 启用登录
      - "suspend_login"       # 禁用登录
    
  # 5. 关系锚点能力
  - id: "relation_anchor"
    name: "关系锚点"
    description: "作为其他实体的关联基础"
    enabled: true
    required: true
    relations:
      - "person_to_project"
      - "person_to_finance"
      - "person_to_quotation"
      - "person_to_client"

# 文档级能力（可配置）
document_capabilities:
  default:
    - editable
    - searchable
    - linkable
    - exportable
    - indexable

  available:
    # 基础操作类
    - id: "editable"
      name: "可编辑"
      description: "允许编辑人员信息"
      requires_permission: "write"
      
    - id: "searchable"
      name: "可搜索"
      description: "可以被全局搜索找到"
      requires_permission: "read"
      
    - id: "linkable"
      name: "可链接"
      description: "可以被其他文档引用"
      requires_permission: "read"
      
    - id: "indexable"
      name: "可索引"
      description: "自动进入 person 索引管道"
      requires_permission: "read"
      required: true

    # 数据操作类
    - id: "exportable"
      name: "可导出"
      description: "导出为 vCard/CSV/Excel"
      requires_permission: "read"
      
    - id: "importable"
      name: "可导入"
      description: "从外部文件导入人员信息"
      requires_permission: "write"

    # 协作类
    - id: "shareable"
      name: "可分享"
      description: "生成人员分享卡片"
      
    - id: "commentable"
      name: "可评论"
      description: "添加人员相关备注"

    # 扩展类
    - id: "syncable"
      name: "可同步"
      description: "与外部系统同步"
      requires_permission: "admin"
      
    - id: "qrcode"
      name: "二维码"
      description: "生成人员二维码名片"

# 能力约束
constraints:
  # 某些能力需要其他能力
  dependencies:
    "importable": ["editable"]
    "syncable": ["importable", "exportable"]
    "login_eligibility": ["identity_recognition", "person_index"]

# 卸载行为定义
uninstall_behavior:
  # 索引处理
  indexes:
    action: "invalidate"
    description: "所有 person 索引标记为失效"
  
  # UI 处理
  ui:
    action: "hide"
    description: "隐藏所有 person 相关 UI 入口"
    
  # 文档处理
  documents:
    action: "preserve"
    description: "文档本体保留，但视为普通文档"
    
  # 登录处理
  login:
    action: "disable"
    description: "所有 person 登录能力失效"


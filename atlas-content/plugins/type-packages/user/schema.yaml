# 用户数据校验规则
# 定义用户文档的数据校验

version: "1.0"

# ============================================================
# 必填字段
# ============================================================

required:
  - name

# ============================================================
# 字段校验规则
# ============================================================

fields:
  # 姓名
  name:
    type: string
    required: true
    min_length: 1
    max_length: 100
    message: "姓名不能为空，且长度不超过100个字符"
    
  # 头像
  avatar:
    type: file
    accept: ["image/jpeg", "image/png", "image/gif", "image/webp"]
    max_size: "5MB"
    
  # 生日
  birthday:
    type: date
    max: "{{today}}"
    message: "生日不能晚于今天"
    
  # 单位（关联客户文档）
  company:
    type: file
    accept: [".md"]
    
  # 部门
  department:
    type: string
    max_length: 50
    
  # 职位
  position:
    type: string
    max_length: 50
    
  # 快递信息
  address:
    type: string
    max_length: 500
    
  # 标签
  tags:
    type: array
    items:
      type: string
      max_length: 20

# ============================================================
# 认证字段校验
# ============================================================

auth_fields:
  # 用户ID
  user_id:
    type: string
    pattern: "^[a-zA-Z0-9_-]+$"
    unique: true
    auto_generate: true
    
  # 用户名
  username:
    type: string
    min_length: 3
    max_length: 50
    pattern: "^[a-zA-Z0-9_]+$"
    unique: true
    message: "用户名只能包含字母、数字和下划线"
    
  # 邮箱（认证用）
  email:
    type: string
    pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
    message: "请输入有效的邮箱地址"
    unique: true
    
  # 手机号（认证用）
  phone:
    type: string
    pattern: "^1[3-9]\\d{9}$"
    message: "请输入有效的手机号码"
    unique: true
    
  # 角色
  role:
    type: string
    enum: ["admin", "manager", "staff", "customer", "guest"]
    default: "customer"
    
  # 状态
  status:
    type: string
    enum: ["active", "inactive", "suspended"]
    default: "active"

# ============================================================
# 联合校验规则
# ============================================================

rules:
  # 姓名必填
  - name: "name_required"
    condition: "name"
    message: "姓名是必填项"
    level: "error"

# ============================================================
# 自动填充规则
# ============================================================

auto_fill:
  id:
    value: "{{generateId('user')}}"
    on: "create"
    
  created_at:
    value: "{{now}}"
    on: "create"
    
  updated_at:
    value: "{{now}}"
    on: "update"

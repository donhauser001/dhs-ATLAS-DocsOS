# Phase 3.7: MD 编辑器优化

## 最终实现

根据用户反馈，MD 编辑器定位为**纯文档编辑器**，不再实现复杂的语义化 YAML 表单（因为已有独立的"表单"视图）。

### 核心设计原则

- **阅读视图** → 阅读体验优化
- **表单视图** → 结构化数据编辑
- **MD 编辑视图** → 源码级文档编辑

三种视图各司其职，不重复功能。

## 最终架构

```
┌─────────────────────────────────────────────────┐
│  陈七                           × 取消    保存   │  ← 标题栏
├─────────────────────────────────────────────────┤
│  ⓘ 系统元数据（固定键）· 7 项              ∧    │  ← 可折叠
│  ┌─────────┬─────────┬─────────┬─────────┐     │
│  │  版本   │  类型   │  创建   │  更新   │     │
│  │  1.0 ▼  │ 事实文档 │2025/01  │(自动)   │     │
│  ├─────────┼─────────┴─────────┴─────────┤     │
│  │  作者   │  功能    │  能力              │     │
│  │ system  │ 登录主体 │ 认证 会话 [+添加] │     │
│  └─────────┴─────────────────────────────┘     │
│  🔒 标有锁图标的字段由系统自动管理               │
├─────────────────────────────────────────────────┤
│  <> 文档内容（标题+Machine Zone+Human Zone）·29行│
│ ┌────┬────────────────────────────────────────┐│
│ │  1 │ # 陈七 {#u-chenqi}                     ││
│ │  2 │                                        ││
│ │  3 │ ```yaml                                ││
│ │  4 │ type: principal                        ││
│ │  5 │ id: u-chenqi                           ││
│ │  6 │ display_name: 陈七                     ││
│ │  7 │ status: active                         ││
│ │  8 │                                        ││
│ │  9 │ identity:                              ││
│ │ 10 │   emails:                              ││
│ │ .. │ ...                                    ││
│ └────┴────────────────────────────────────────┘│
│   行号    可编辑内容区                          │
├─────────────────────────────────────────────────┤
│  联系人/principals/u-chenqi.md   1个Block 5个键 │  ← 状态栏
└─────────────────────────────────────────────────┘
```

## 实现的功能

### 1. 固定键区（表单编辑）

frontmatter 中的系统元数据字段：

| 字段 | 类型 | 可编辑 | 说明 |
|------|------|--------|------|
| `version` | 下拉选择器 | ✅ | 支持保持/小版本/大版本/手动输入 |
| `document_type` | 下拉选择器 | ✅ | 文档类型（principal/facts/note等） |
| `created` | 日期 | ❌ | 创建时间（只读） |
| `updated` | 日期 | ❌ | 更新时间（保存时自动更新） |
| `author` | 文本 | ✅ | 作者 |
| `atlas.function` | 下拉选择器 | ✅ | 功能声明（根据类型筛选） |
| `atlas.capabilities` | 标签选择 | ✅ | 能力声明（根据功能自动匹配） |

### 2. 文档内容区（源码编辑）

- 带行号的代码编辑器风格
- 深色主题 (slate-900)
- 等宽字体 (font-mono)
- 实时行数统计
- 滚动同步

### 3. 快捷键支持

- `⌘S` / `Ctrl+S` - 保存
- `Esc` - 取消编辑

## 关键文件

```
frontend/src/components/editor/smart-editor/
├── SmartDocEditor.tsx       # 主编辑器组件
├── useEditorState.ts        # 编辑器状态管理
├── fixedKeyConfig.tsx       # 固定键配置
├── FixedKeyField.tsx        # 固定键字段渲染
├── VersionSelector.tsx      # 版本选择器
├── DocumentTypeSelector.tsx # 文档类型选择器
├── FunctionSelector.tsx     # 功能选择器
├── CapabilitiesField.tsx    # 能力字段
└── types.ts                 # 类型定义
```

## 用户体验

1. **固定键区** - 表单化编辑 frontmatter
   - 不会写 YAML 的用户可以通过下拉框、标签等控件修改元数据
   
2. **内容区** - 源码级编辑
   - 熟悉 Markdown 的用户直接编辑源码
   - 行号辅助定位

3. **职责分离**
   - 想要可视化编辑业务数据？用"表单"视图
   - 想要直接编辑源码？用"MD编辑"视图

## 原计划（已废弃）

原计划是在 MD 编辑器中实现 YAML 语义化表单编辑，但用户反馈：

> "不需要再表单化了，因为我们已经有表单视图了，还是文档化，只希望有一种更友好的编辑界面"

因此，MD 编辑器保持为纯文档编辑器，语义化组件（semantic-yaml/*）保留但主要用于"表单"视图中的 Block 渲染。

## 相关 Phase

- **Phase 3.5** - 固定键系统
- **Phase 3.6** - 场景化视图系统（阅读/表单/MD编辑三视图）

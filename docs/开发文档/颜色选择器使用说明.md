# 颜色选择器使用说明

## 概述

`ColorPicker` 是一个功能完善的颜色选择组件，提供预设颜色、扩展色板和自定义颜色输入功能。

## 基本用法

```tsx
import { ColorPicker } from '@/components/ui/color-picker'

function MyComponent() {
  const [color, setColor] = useState('#3b82f6')

  return (
    <ColorPicker
      value={color}
      onChange={setColor}
    />
  )
}
```

## Props

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `value` | `string` | - | 当前选中的颜色值（HEX 格式） |
| `onChange` | `(value: string) => void` | - | 颜色变化时的回调函数 |
| `disabled` | `boolean` | `false` | 是否禁用 |
| `placeholder` | `string` | `'选择颜色'` | 未选择时的占位文本 |

## 颜色格式

组件使用 **HEX 格式** 存储和传递颜色值：

```tsx
// ✅ 正确 - 6位 HEX
<ColorPicker value="#3b82f6" onChange={setColor} />
<ColorPicker value="#ef4444" onChange={setColor} />

// ✅ 正确 - 3位 HEX（会自动扩展）
<ColorPicker value="#f00" onChange={setColor} />

// ❌ 避免 - 不支持其他格式
<ColorPicker value="rgb(59, 130, 246)" onChange={setColor} />
<ColorPicker value="blue" onChange={setColor} />
```

## 预设颜色

### 主色板（24色）

组件提供 24 种精选主色，覆盖常用场景：

| 色系 | 颜色 |
|------|------|
| 红色系 | `#ef4444` `#f97316` `#f59e0b` |
| 黄绿系 | `#eab308` `#84cc16` `#22c55e` |
| 青蓝系 | `#10b981` `#14b8a6` `#06b6d4` |
| 蓝紫系 | `#0ea5e9` `#3b82f6` `#6366f1` |
| 紫粉系 | `#8b5cf6` `#a855f7` `#d946ef` |
| 粉红系 | `#ec4899` `#f43f5e` |
| 中性色 | `#64748b` `#78716c` `#71717a` |
| 灰度 | `#000000` `#ffffff` `#6b7280` `#9ca3af` |

### 扩展色板（48色）

点击「更多颜色」展开扩展色板，提供更多色彩选择：

- 每种主色的浅色和深色变体
- 更细腻的色彩过渡
- 适合需要精确配色的场景

## 自定义颜色

支持直接输入 HEX 颜色值：

```
输入框支持：
- 6位 HEX: #3b82f6
- 3位 HEX: #38f (自动扩展为 #3388ff)
- 无井号: 3b82f6 (自动添加 #)
```

## 工具函数

组件导出了几个实用的颜色工具函数：

### isLightColor

判断颜色是否为浅色（用于决定文字颜色）：

```tsx
import { isLightColor } from '@/components/ui/color-picker'

function ColorBadge({ color, label }) {
  const textColor = isLightColor(color) ? '#000' : '#fff'
  
  return (
    <span style={{ backgroundColor: color, color: textColor }}>
      {label}
    </span>
  )
}
```

### getContrastColor

获取对比色（自动返回黑色或白色）：

```tsx
import { getContrastColor } from '@/components/ui/color-picker'

function IconContainer({ color, icon }) {
  return (
    <div style={{ backgroundColor: color }}>
      <Icon style={{ color: getContrastColor(color) }} />
    </div>
  )
}
```

### PRESET_COLORS / EXTENDED_COLORS

获取预设颜色数组：

```tsx
import { PRESET_COLORS, EXTENDED_COLORS } from '@/components/ui/color-picker'

// PRESET_COLORS: 24 种主色
// EXTENDED_COLORS: 48 种扩展色
```

## 与表单集成

### React Hook Form

```tsx
import { Controller, useForm } from 'react-hook-form'
import { ColorPicker } from '@/components/ui/color-picker'

function CategoryForm() {
  const { control } = useForm()

  return (
    <Controller
      name="color"
      control={control}
      render={({ field }) => (
        <ColorPicker
          value={field.value}
          onChange={field.onChange}
        />
      )}
    />
  )
}
```

### 普通表单

```tsx
function CategoryForm() {
  const [form, setForm] = useState({ color: '#3b82f6' })

  return (
    <div className="space-y-2">
      <label className="text-sm font-medium">颜色</label>
      <ColorPicker
        value={form.color}
        onChange={(color) => setForm({ ...form, color })}
      />
    </div>
  )
}
```

## 样式定制

### 触发按钮

触发按钮采用胶囊式设计，显示当前颜色预览：

```tsx
<ColorPicker
  value={color}
  onChange={setColor}
  className="w-full" // 全宽按钮
/>
```

### 弹出面板

- 使用 `fixed` 定位，确保在模态框内正常显示
- `z-index: 101`，高于模态框遮罩
- 圆角 `rounded-2xl`，与整体设计统一

## 应用场景

### 分类标识

```tsx
<div 
  className="w-3 h-3 rounded-full"
  style={{ backgroundColor: category.color }}
/>
```

### 图标容器

```tsx
<div
  className="flex h-10 w-10 items-center justify-center rounded-xl"
  style={{ backgroundColor: category.color }}
>
  <DynamicIcon 
    name={category.icon} 
    className="h-5 w-5"
    style={{ color: getContrastColor(category.color) }}
  />
</div>
```

### 状态标签

```tsx
<Badge
  style={{ 
    backgroundColor: `${status.color}20`, // 20% 透明度背景
    color: status.color 
  }}
>
  {status.label}
</Badge>
```

## 完整示例

```tsx
import { useState } from 'react'
import { ColorPicker, getContrastColor } from '@/components/ui/color-picker'
import { IconPicker, DynamicIcon } from '@/components/ui/icon-picker'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'

function CreateCategoryForm({ onSubmit }) {
  const [form, setForm] = useState({
    name: '',
    icon: 'folder',
    color: '#3b82f6',
  })

  return (
    <form onSubmit={() => onSubmit(form)} className="space-y-6">
      {/* 实时预览 */}
      <div className="flex items-center gap-3 p-4 rounded-2xl border bg-muted/30">
        <div
          className="flex h-12 w-12 items-center justify-center rounded-xl shadow-sm"
          style={{ backgroundColor: form.color }}
        >
          <DynamicIcon 
            name={form.icon} 
            className="h-6 w-6"
            style={{ color: getContrastColor(form.color) }}
          />
        </div>
        <div>
          <div className="font-semibold">{form.name || '分类名称'}</div>
          <div className="text-sm text-muted-foreground">
            {form.icon} · {form.color}
          </div>
        </div>
      </div>

      {/* 名称 */}
      <div className="space-y-2">
        <label className="text-sm font-medium">名称 *</label>
        <Input
          value={form.name}
          onChange={(e) => setForm({ ...form, name: e.target.value })}
          placeholder="输入分类名称"
        />
      </div>

      {/* 图标和颜色 */}
      <div className="grid grid-cols-2 gap-4">
        <div className="space-y-2">
          <label className="text-sm font-medium">图标</label>
          <IconPicker
            value={form.icon}
            onChange={(icon) => setForm({ ...form, icon })}
          />
        </div>
        <div className="space-y-2">
          <label className="text-sm font-medium">颜色</label>
          <ColorPicker
            value={form.color}
            onChange={(color) => setForm({ ...form, color })}
          />
        </div>
      </div>

      <Button type="submit" className="w-full">
        创建分类
      </Button>
    </form>
  )
}
```

## 注意事项

1. **颜色格式统一**: 始终使用 HEX 格式存储
2. **对比度考虑**: 使用 `getContrastColor` 确保文字可读性
3. **透明度技巧**: 使用 `${color}20` 格式创建半透明背景
4. **数据库存储**: 存储完整的 HEX 值（如 `#3b82f6`）


# 目录与文件命名规范

## 概述

ATLAS DocsOS 采用 **文档化数据存储** 架构，所有业务数据以 Markdown (`.md`) 或 YAML (`.yml`) 文件形式存储在 `repository/workspace` 目录中。

## 核心原则

### 1. 中文命名（强制）

所有目录和文件**必须使用中文命名**，禁止英文、拼音、缩写。

```
✅ 正确
├── 服务定价/
├── 组织/
├── 用户/
└── 配置.yml

❌ 错误
├── service-pricing/
├── organization/
├── fuwu/
└── config.yml
```

### 2. 文件格式选择

| 格式 | 扩展名 | 适用场景 |
|------|--------|----------|
| **Markdown** | `.md` | 需要叙事内容 + 结构化数据混合的场景 |
| **YAML** | `.yml` | 纯配置、纯结构化数据 |

```
服务清单.md    → 有分类说明、服务详情等叙事内容
配置.yml       → 纯系统配置
部门.yml       → 纯列表数据
```

## 目录结构

### 完整目录树

```
repository/workspace/
├── 配置.yml              # 系统全局配置
│
├── 服务定价/             # 服务与定价模块
│   ├── 服务清单.md       # 服务分类 + 服务项目
│   └── 附加配置.md       # 附加选项配置
│
├── 组织/                 # 组织架构模块
│   ├── 企业资料.yml      # 公司基本信息
│   ├── 部门.yml          # 部门列表
│   └── 职位.yml          # 职位列表
│
├── 用户/                 # 用户数据（按用户ID分目录）
│   └── {user_id}/        # 用户目录（英文ID）
│       ├── 资料.md       # 个人资料（Frontmatter + 简介）
│       └── 偏好.yml      # 用户偏好设置
│
├── 命令/                 # 命令定义（系统内部）
│   ├── 项目.yml
│   ├── 任务.yml
│   └── 服务定价.yml
│
└── 状态机/               # 状态机定义（系统内部）
    ├── 项目.yml
    └── 任务.yml
```

### 目录分类

| 目录 | 类型 | 说明 |
|------|------|------|
| `服务定价/` | 业务数据 | 服务、定价、配置 |
| `组织/` | 业务数据 | 公司、部门、职位 |
| `用户/` | 用户数据 | 按用户分目录存储 |
| `命令/` | 系统配置 | Command 定义 |
| `状态机/` | 系统配置 | 状态机定义 |

## 文件格式规范

### Markdown 文件 (.md)

适用于需要 **结构化数据 + 叙事说明** 的场景。

#### 结构模式

```markdown
---
# YAML Frontmatter（全局配置）
version: "1.0"
updated: 2025-01-01
---

# 文档标题

> 简要说明

---

## 分类/区块 {#anchor-id}

```yaml
# 结构化数据块
id: xxx
name: xxx
```

叙事说明内容...

---

## 下一个分类...
```

#### 示例：服务清单.md

```markdown
---
version: "1.0"
currency: CNY
updated: 2025-12-31
---

# 服务清单

> 本文档定义了所有可提供的服务项目。

---

## 分类定义

### 封面设计 {#cat-cover-design}

```yaml
id: cover-design
name: 封面设计
color: "#8B5CF6"
icon_key: book-open
```

图书封面及相关设计服务...

---

## 服务项目

### 精装单封 {#srv-hardcover-single}

```yaml
id: hardcover-single
name: 精装单封
slug: hardcover-single
category: cover-design
base_price: 2500
unit: 本
price_type: fixed
status: active
```

精装图书的单面封面设计服务...
```

### YAML 文件 (.yml)

适用于 **纯配置、纯列表数据**。

#### 示例：部门.yml

```yaml
# 部门列表
departments:
  - id: dept-design
    name: 设计部
    code: DESIGN
    manager_id: zhangsan
    status: active
    
  - id: dept-tech
    name: 技术部
    code: TECH
    manager_id: lisi
    status: active
```

#### 示例：配置.yml

```yaml
# 系统配置
system:
  name: ATLAS Docs OS
  version: 0.1.0

# ID 生成规则
project_id:
  prefix: P
  format: "{prefix}-{year}-{seq:04d}"

# 状态颜色映射
colors:
  gray: "#6b7280"
  blue: "#3b82f6"
  green: "#22c55e"
```

## 用户目录规范

用户数据按用户 ID 分目录存储：

```
用户/
├── zhangsan/           # 用户目录（使用用户ID，英文）
│   ├── 资料.md         # 个人资料
│   └── 偏好.yml        # 用户偏好
├── lisi/
│   ├── 资料.md
│   └── 偏好.yml
└── ...
```

### 资料.md 格式

```markdown
---
id: zhangsan
username: zhangsan
name: 张三
email: zhangsan@atlas.local
phone: "13800138000"
department: 设计部
position: 设计总监
role: admin
status: active
created_at: 2025-01-01
updated_at: 2025-01-15
---

# 张三

## 个人简介

资深设计师，擅长品牌视觉设计...
```

### 偏好.yml 格式

```yaml
# 用户偏好设置
language: zh-CN
theme: light
timezone: Asia/Shanghai

# 通知设置
notifications:
  email: true
  push: true
  
# 显示设置
display:
  items_per_page: 20
  default_view: grid
```

## 命名约定

### ID 命名规则

| 类型 | 格式 | 示例 |
|------|------|------|
| 分类 ID | `kebab-case` | `cover-design`, `marketing-material` |
| 服务 ID | `kebab-case` | `hardcover-single`, `web-detail-page` |
| 用户 ID | `lowercase` | `zhangsan`, `awp` |
| 部门 ID | `dept-{name}` | `dept-design`, `dept-tech` |

### 锚点命名规则

Markdown 锚点使用 `{#prefix-id}` 格式：

| 类型 | 前缀 | 示例 |
|------|------|------|
| 分类 | `cat-` | `{#cat-cover-design}` |
| 服务 | `srv-` | `{#srv-hardcover-single}` |
| 配置 | `cfg-` | `{#cfg-rush-fee}` |

### Slug 命名规则

用于 URL 的 slug 使用 **英文 kebab-case**：

```yaml
name: 精装单封
slug: hardcover-single  # URL: /services/hardcover-single
```

## 文件组织原则

### 1. 单文件聚合

相关数据尽量聚合在单个文件中，减少文件碎片：

```
✅ 推荐
服务定价/
├── 服务清单.md    # 分类 + 服务项目 全部在一个文件
└── 附加配置.md    # 所有附加配置在一个文件

❌ 避免
服务定价/
├── 分类/
│   ├── 封面设计.yml
│   ├── 版式设计.yml
│   └── ...
└── 服务/
    ├── 精装单封.yml
    ├── 平装双封.yml
    └── ...
```

### 2. 目录按功能模块划分

```
✅ 正确：按功能模块
├── 服务定价/    # 定价相关
├── 组织/        # 组织架构相关
└── 用户/        # 用户相关

❌ 错误：按文件类型
├── configs/
├── data/
└── templates/
```

### 3. 系统文件与业务文件分离

```
workspace/
├── 配置.yml      # 系统配置
├── 命令/         # 系统：命令定义
├── 状态机/       # 系统：状态机
├── 服务定价/     # 业务：服务定价
├── 组织/         # 业务：组织架构
└── 用户/         # 业务：用户数据
```

## 版本控制

### Git 提交消息

```
[模块] 动作描述

示例：
[服务定价] 新增封面设计分类
[用户] 更新张三资料
[配置] 修改项目ID格式
```

### 文件变更追踪

每个文件应包含 `updated` 字段：

```yaml
---
updated: 2025-01-15T10:30:00Z
---
```

## 最佳实践

### ✅ 推荐

1. 目录和文件使用中文命名
2. ID 和 slug 使用英文 kebab-case
3. 相关数据聚合在单文件
4. Markdown 用于混合内容，YAML 用于纯数据
5. 使用锚点建立文档内引用

### ❌ 避免

1. 英文/拼音/缩写命名目录和文件
2. 过度拆分文件（一个实体一个文件）
3. 混用命名风格
4. 在 YAML 文件中写大段叙事内容
5. 硬编码路径（使用配置项）

## 路径引用

### 后端代码引用

```typescript
// 使用中文路径
const WORKSPACE_PATH = 'repository/workspace'
const SERVICES_FILE = `${WORKSPACE_PATH}/服务定价/服务清单.md`
const CONFIG_FILE = `${WORKSPACE_PATH}/配置.yml`
const USER_PROFILE = (id: string) => `${WORKSPACE_PATH}/用户/${id}/资料.md`
```

### 文档内引用

```markdown
<!-- 引用其他文档 -->
详见 [附加配置](./附加配置.md)

<!-- 引用锚点 -->
属于 [封面设计](#cat-cover-design) 分类
```


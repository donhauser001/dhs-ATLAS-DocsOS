# 4.2.4 - è®¤è¯ç´¢å¼•æœåŠ¡ï¼ˆä¸¥æ ¼æ ‡è¯†ç¬¦ï¼‰

> ä¼˜å…ˆçº§: ğŸ”´ é«˜  
> é¢„ä¼°å·¥æœŸ: 3 å¤©  
> ä¾èµ–ä»»åŠ¡: 4.2.1  
> çŠ¶æ€: âœ… å·²å®Œæˆ

## ä»»åŠ¡æ¦‚è¿°

å®ç°ç”¨æˆ·è®¤è¯ç´¢å¼•æœåŠ¡ï¼ŒåŸºäº `type: __atlas_user_auth__` ä¸¥æ ¼æ ‡è¯†ç¬¦è¯†åˆ«ç”¨æˆ·è®¤è¯ç»„ä»¶ï¼Œæ„å»º `auth-users.json` ç´¢å¼•ã€‚

## ç›®æ ‡

- [x] å®ç°ç´¢å¼•æ•°æ®ç»“æ„
- [x] å®ç°æ–‡æ¡£æ‰«æè¯†åˆ«
- [x] å®ç°å‡­è¯æ˜ å°„
- [x] æ”¯æŒå•æ–‡æ¡£å¤šç”¨æˆ·
- [x] å®ç°ç´¢å¼•é‡å»ºåŠŸèƒ½

## æŠ€æœ¯è¦ç‚¹

### ä¸¥æ ¼æ ‡è¯†ç¬¦

```typescript
const AUTH_BLOCK_TYPE = '__atlas_user_auth__';
```

åªè¯†åˆ« `type: __atlas_user_auth__` çš„æ•°æ®å—ï¼Œå¿½ç•¥æ‰€æœ‰æ•£è½å­—æ®µã€‚

### ç´¢å¼•æ•°æ®ç»“æ„

```json
{
  "_meta": {
    "index_name": "auth-users",
    "version": "2.0",
    "identifier": "__atlas_user_auth__",
    "last_full_scan": "...",
    "last_update": "...",
    "stats": { ... }
  },
  "credentials": {
    "zhangsan": { "type": "username", "user_id": "U20260106001" },
    "zhangsan@example.com": { "type": "email", "user_id": "U20260106001" }
  },
  "users": {
    "U20260106001": { ... }
  }
}
```

### æ ¸å¿ƒå‡½æ•°

```typescript
// æ‰«ææ–‡æ¡£ï¼Œæå–æ‰€æœ‰ç”¨æˆ·è®¤è¯ç»„ä»¶
function scanDocument(docPath: string, content: string): UserRecord[]

// é‡å»ºç´¢å¼•
async function rebuildAuthUsersIndex(): Promise<AuthUsersIndex>

// è·å–ç´¢å¼•
async function getAuthUsersIndex(): Promise<AuthUsersIndex>
```

## æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ |
|------|----------|
| `backend/src/services/auth-credential-indexer.ts` | æ–°å¢ |
| `backend/src/api/indexes.ts` | ä¿®æ”¹ |
| `.atlas/indexes/auth-users.json` | è‡ªåŠ¨ç”Ÿæˆ |

## å­ä»»åŠ¡

- [x] Day 1: è®¾è®¡ç´¢å¼•ç»“æ„ï¼Œå®ç°æ–‡æ¡£æ‰«æ
- [x] Day 2: å®ç°å‡­è¯æ˜ å°„ï¼Œæ”¯æŒå•æ–‡æ¡£å¤šç”¨æˆ·
- [x] Day 3: å®ç°é‡å»º APIï¼Œæµ‹è¯•

## éªŒæ”¶æ ‡å‡†

1. åªè¯†åˆ« `__atlas_user_auth__` æ•°æ®å—
2. æ­£ç¡®æ„å»ºå‡­è¯æ˜ å°„
3. æ”¯æŒå•æ–‡æ¡£å¤šç”¨æˆ·
4. ç´¢å¼•é‡å»º API æ­£å¸¸å·¥ä½œ
5. å¿½ç•¥æ•£è½çš„ email/phone/password å­—æ®µ

## è¿›åº¦è®°å½•

| æ—¥æœŸ | è¿›åº¦ | å¤‡æ³¨ |
|------|------|------|
| 2026-01-06 | 100% | å…¨éƒ¨å®Œæˆ |

---

*åˆ›å»ºæ—¥æœŸ: 2026-01-06*  
*å®Œæˆæ—¥æœŸ: 2026-01-06*

